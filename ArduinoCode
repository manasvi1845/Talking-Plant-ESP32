#include "DHT.h"

// Pin configuration
#define DHTPIN 27              // DHT11 sensor data pin
#define DHTTYPE DHT11          // Sensor type
#define SOIL_MOISTURE_PIN 35   // Soil moisture sensor pin
#define GAS_SENSOR_PIN 34      // MQ2 gas sensor pin
#define RELAY_PIN 25           // Relay for water pump
#define SPEAKER_PIN 26         // Speaker output pin (optional)

DHT dht(DHTPIN, DHTTYPE);
int soilThreshold = 300;       // Set your soil moisture threshold

void setup() {
  Serial.begin(115200);
  dht.begin();
  pinMode(RELAY_PIN, OUTPUT);
  pinMode(SPEAKER_PIN, OUTPUT);
  Serial.println("üåø Talking Plant System Initialized üåø");
}

void loop() {
  // Read all sensors
  float humidity = dht.readHumidity();
  float temperature = dht.readTemperature();
  int soilValue = analogRead(SOIL_MOISTURE_PIN);
  int gasValue = analogRead(GAS_SENSOR_PIN);

  Serial.println("\n===============================");
  Serial.println("Plant Health Report");
  Serial.println("===============================");
  Serial.print("Temperature: "); Serial.print(temperature); Serial.println(" ¬∞C");
  Serial.print("Humidity: "); Serial.print(humidity); Serial.println(" %");
  Serial.print("Soil Moisture: "); Serial.println(soilValue);
  Serial.print("Gas Sensor: "); Serial.println(gasValue);
  Serial.println("===============================\n");

  // Analyze plant conditions
  checkSoil(soilValue);
  checkGas(gasValue);
  delay(5000); // Wait 5 seconds before next reading
}

// Function to check soil condition
void checkSoil(int soilValue) {
  if (soilValue < soilThreshold) {
    Serial.println("ü™¥ Plant is thirsty! Watering now...");
    digitalWrite(RELAY_PIN, HIGH); // Turn on pump
    tone(SPEAKER_PIN, 1000, 500);  // Sound alert
    delay(3000);
    digitalWrite(RELAY_PIN, LOW);  // Turn off pump
    Serial.println("‚úÖ Watering complete!");
  } else {
    Serial.println("üíß Soil moisture is good.");
  }
}

// Function to check gas/smoke level
void checkGas(int gasValue) {
  if (gasValue > 1000) {
    Serial.println("‚ö†Ô∏è Warning: Harmful gas detected!");
    tone(SPEAKER_PIN, 1500, 1000); // Audio alert
  } else {
    Serial.println("üå¨Ô∏è Air quality is safe.");
  }
}
